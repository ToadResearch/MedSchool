# Doctor‑Style MCP Tool Question Bank Generated by Dr. GPT


> Natural language prompts a clinician might say. Grouped by **single‑tool smoke tests** and **multi‑tool benchmarks**. Use them as-is to exercise your MCP server.

---

## Notes for running these

* Where a patient is referenced without an ID, try name search first; if ambiguous, fall back to the most recent encounter or ask me to specify an **FHIR ID**.
* When I paste JSON, please **validate** first (if relevant) and explain any errors plainly.

---

## Single‑Tool Smoke Tests

### A) FHIR Query (`fhir_query`)

        "use": "official",
        "family": "Nienow652",
        "given": [ "Abdul218", "Myles862" ],
        "prefix": [ "Mr." ]
      } ],

get total patient count with GET "[base]/Patient?_summary=count&_total=accurate"
get all resource counts with "GET [base]/$get-resource-counts"

---

Locked to **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54** for all of them. Here are the prompts rewritten plus the **best FHIR R4 queries**.

---

1. *“Show me **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**’s last three **blood pressure** readings, with dates and units.”*

```http
GET [base]/Observation
  ?subject=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=vital-signs
  &code=http://loinc.org|85354-9,http://loinc.org|55284-4
  &_sort=-date
  &_count=3
```
2. *“List **active medications** for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**, including dose, route, and frequency.”*

```http
GET [base]/MedicationRequest
  ?patient=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &status=active
  &_include=MedicationRequest:medication
  &_sort=-authoredon
```

3. *“Pull the **problem list** for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**, but only SNOMED-coded problems.”*

```http
GET [base]/Condition
  ?patient=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=http://terminology.hl7.org/CodeSystem/condition-category|problem-list-item
  &code=http://snomed.info/sct|
  &_sort=-_lastUpdated
```

4. *“What **allergies** are on file for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**?”*

```http
GET [base]/AllergyIntolerance
  ?patient=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &clinical-status=active
  &verification-status=confirmed
  &_sort=-recorded-date
```

5. *“Give me the **most recent serum creatinine** result and the **reference range** for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**.”*

```http
GET [base]/Observation
  ?subject=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=laboratory
  &code=http://loinc.org|2160-0
  &_sort=-date
  &_count=1
```

6. *“Show the last **three encounters** for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**, with type, location, and discharge diagnosis.”*

```http
GET [base]/Encounter
  ?patient=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &status=finished
  &_sort=-date
  &_count=3
  &_include=Encounter:location
  &_revinclude=Condition:encounter
```

*(Use the included/\_revincluded resources to extract location details and any Conditions linked to the encounter; look for discharge diagnoses via `Encounter.diagnosis.use=discharge` if populated, or Conditions with category `encounter-diagnosis`.)*

7. *“List any **abnormal lab results** for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54** in the past **30 days**.”*
   (Today is 2025-08-27 ⇒ 30 days ago = **2025-07-28**.)

```http
GET [base]/Observation
  ?subject=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=laboratory
  &date=ge2025-07-28
  &interpretation=http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|H,
                   http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|HH,
                   http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|L,
                   http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|LL,
                   http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|A,
                   http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation|AA
  &_sort=-date
```

8. *“Find all **HbA1c** observations for **Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54**, newest first.”*

```http
GET [base]/Observation
  ?subject=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=laboratory
  &code=http://loinc.org|4548-4
  &_sort=-date
```


9) “Calculate liver fibrosis risk (FIB-4) from the latest labs for Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54.”**

```http
# Get the last few AST, ALT, and Platelet results (you'll pick the most recent of each)
GET [base]/Observation
  ?subject=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &category=laboratory
  &code=http://loinc.org|1920-8,     # AST
        http://loinc.org|1742-6,     # ALT
        http://loinc.org|777-3       # Platelet count
  &_sort=-date
  &_count=30

# Get birthDate (for age in years) and gender (not used in formula, but commonly logged)
GET [base]/Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
```

10) “Compute encounter payment stats for Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54 (total paid, patient responsibility, allowed vs submitted), and summarize by encounter.”**


```http
GET [base]/ExplanationOfBenefit
  ?patient.identifier=http://hospital.smarthealthit.org|1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &_include=ExplanationOfBenefit:encounter
  &_elements=id,patient,created,encounter,item,adjudication,payment,total,status
  &_sort=-created
  &_count=200
```

> Optional filters you can add:
>
> * `&created=ge2025-01-01` (limit to a date window)
> * `&status=active` (skip reversed/entered-in-error)
> * `&_elements=id,created,encounter,total,payment,item,adjudication` (trim payload if supported)

Then calculate in python

```python
# Inputs: Bundle of ExplanationOfBenefit + included Encounters
# Goals:
#  - Total insurer payment to provider
#  - Patient responsibility (coinsurance, copay, deductible)
#  - Allowed vs submitted charges
#  - Per-encounter rollups + simple stats

from statistics import mean, median, pstdev

def get_money(x):
    if isinstance(x, dict):
        return float(x.get("value", 0.0))
    return float(x or 0.0)

paid_keys = {
    # Standard R4 adjudication category
    ("http://terminology.hl7.org/CodeSystem/adjudication", "benefit"),
    # BlueButton-style line provider payment
    ("https://bluebutton.cms.gov/resources/codesystem/adjudication",
     "https://bluebutton.cms.gov/resources/variables/line_prvdr_pmt_amt"),
}
pt_resp_keys = {
    # BlueButton-style patient responsibility components
    ("https://bluebutton.cms.gov/resources/codesystem/adjudication",
     "https://bluebutton.cms.gov/resources/variables/line_coinsrnc_amt"),
    ("https://bluebutton.cms.gov/resources/codesystem/adjudication",
     "https://bluebutton.cms.gov/resources/variables/line_bene_ptb_ddctbl_amt"),
    # Copay (add your server's code if present)
    ("http://terminology.hl7.org/CodeSystem/adjudication", "copay"),
}
allowed_keys = {
    ("https://bluebutton.cms.gov/resources/codesystem/adjudication",
     "https://bluebutton.cms.gov/resources/variables/line_alowd_chrg_amt"),
    ("http://terminology.hl7.org/CodeSystem/adjudication", "allowed"),
}
submitted_keys = {
    ("https://bluebutton.cms.gov/resources/codesystem/adjudication",
     "https://bluebutton.cms.gov/resources/variables/line_sbmtd_chrg_amt"),
    ("http://terminology.hl7.org/CodeSystem/adjudication", "submitted"),
}

def sum_adjudication(item, keyset):
    total = 0.0
    for adj in item.get("adjudication", []):
        cat = adj.get("category", {}).get("coding", [{}])[0]
        key = (cat.get("system"), cat.get("code"))
        if key in keyset:
            total += get_money(adj.get("amount"))
    return total

def rollup_eob(eob):
    enc_ids = []
    for enc_ref in eob.get("encounter", []):
        ref = enc_ref.get("reference", "")
        if ref.startswith("Encounter/"):
            enc_ids.append(ref.split("/",1)[1])
    # Line-level sums
    paid = pt_resp = allowed = submitted = 0.0
    for it in eob.get("item", []):
        paid     += sum_adjudication(it, paid_keys)
        pt_resp  += sum_adjudication(it, pt_resp_keys)
        allowed  += sum_adjudication(it, allowed_keys)
        submitted+= sum_adjudication(it, submitted_keys)
        # fallback: some servers put totals at EOB.total or EOB.payment
    if paid == 0:
        paid = get_money(eob.get("payment", {}).get("amount"))
    return {
        "encounters": enc_ids or ["(none)"],
        "paid": round(paid,2),
        "patient_resp": round(pt_resp,2),
        "allowed": round(allowed,2),
        "submitted": round(submitted,2),
        "created": eob.get("created"),
        "eob_id": eob.get("id"),
    }

# --- Assume `bundle` is your EOB search response JSON ---
entries = bundle.get("entry", []) if 'bundle' in globals() else []
rows = []
for ent in entries:
    res = ent.get("resource", {})
    if res.get("resourceType") == "ExplanationOfBenefit":
        rows.append(rollup_eob(res))

# Per-encounter aggregation
from collections import defaultdict
enc_rollup = defaultdict(lambda: {"paid":0.0, "patient_resp":0.0, "allowed":0.0, "submitted":0.0, "eobs":0})
for r in rows:
    for enc in r["encounters"]:
        enc_rollup[enc]["paid"]        += r["paid"]
        enc_rollup[enc]["patient_resp"]+= r["patient_resp"]
        enc_rollup[enc]["allowed"]     += r["allowed"]
        enc_rollup[enc]["submitted"]   += r["submitted"]
        enc_rollup[enc]["eobs"]        += 1

# Simple stats across encounters
paid_vals = [v["paid"] for v in enc_rollup.values()]
summary = {
    "encounter_count": len(enc_rollup),
    "total_paid": round(sum(paid_vals), 2),
    "mean_paid_per_encounter": round(mean(paid_vals), 2) if paid_vals else 0.0,
    "median_paid_per_encounter": round(median(paid_vals), 2) if paid_vals else 0.0,
    "paid_spread_sd": round(pstdev(paid_vals), 2) if len(paid_vals) > 1 else 0.0
}

print("Per-encounter rollup:", dict(enc_rollup))
print("Overall summary:", summary)
```




11. *“Get the number of **Patient** resources on this server.”*

```http
GET [base]/Patient?_summary=count&_total=accurate
```

12. *“Get the total number of **each resource type** on this server.”*

```http
GET [base]/$get-resource-counts
```


---

### B) Terminology Lookup (`code_lookup`)

1. *“What is the official display name and common synonyms for **SNOMED 44054006**?”*
2. *“What does **LOINC 4548‑4** represent? Include any known synonyms.”*
3. *“What is the display for **RxNorm 617314**?”*
4. *“I have **ICD‑10‑CM E11.9**—what’s the official title and any alternate names?”*
5. *“Confirm the system and preferred term for code **‘I10’**.”*

---

### C) SNOMED ↔ ICD‑10 Crosswalks (`snomed_to_icd10`, `icd10_to_snomed`)

1. *“Map **SNOMED 44054006** to candidate **ICD‑10‑CM** codes.”*
2. *“Translate **ICD‑10‑CM E11.9** into likely **SNOMED CT** concepts.”*
3. *“If a problem is coded as **E11.9**, what SNOMED term should I consider?”*
4. *“Given **SNOMED 44054006**, which ICD‑10 billable code would you choose?”*

---

### D) FHIR Validate (`fhir_validate`)

1. *“Does this **Observation** JSON pass R4 validation? If not, tell me exactly what to fix.”* (Paste JSON)
2. *“Validate this **MedicationRequest** I drafted before I submit it.”* (Paste JSON)
3. *“Check this **Condition** resource for required fields and coding issues.”* (Paste JSON)
4. *“Is this **Bundle (transaction)** syntactically valid?”* (Paste JSON)

---

### E) FHIR Doc Cheat‑Sheets (`fhir_doc`)

1. *“Quick refresher: what are the key elements of **Patient**?”*
2. *“Give me a high‑level cheat sheet for **Observation**—which fields matter most?”*
3. *“What are the important fields on **MedicationRequest** again?”*
4. *“Show me a minimal, valid **Condition** example and the fields I shouldn’t forget.”*

---

### F) Python Sandbox (`python_exec`)

1. *“Here’s a short list of blood pressures `[128, 142, 151, 134, 126]`. Compute the **mean**, **std dev**, and flag any values **≥140**.”*
2. *“Given hemoglobin values `[11.8, 12.2, 10.9, 13.1]`, compute the **trend slope per week**.”*
3. *“I have weights in kg `[72.0, 73.2, 72.8]` and heights in meters `[1.70, 1.70, 1.70]`. Compute **BMI for each** and the **average**.”*
4. *“From this small JSON array of labs, print a table of **date**, **test**, **value**, **flag**.”*

```json
[
  {"date": "2025-07-18T14:32:00Z", "test": "HbA1c",     "value": 7.6,  "flag": "H"},
  {"date": "2025-07-18T14:32:00Z", "test": "Potassium", "value": 5.3,  "flag": "H"},
  {"date": "2025-07-18T14:32:00Z", "test": "Creatinine","value": 1.1,  "flag": ""},
  {"date": "2025-05-04T09:12:00Z", "test": "ALT",       "value": 68,   "flag": "H"},
  {"date": "2025-04-22T08:05:00Z", "test": "Hemoglobin","value": 11.1, "flag": "L"}
]
```

---

## Multi‑Tool Benchmarks (harder; require combining tools)

### 1) Clinical Retrieval + Terminology

1. *“Identify **all of Patient 12345’s** diabetes‑related problems by **SNOMED**, then give me the **ICD‑10‑CM equivalents** I can use for billing.”*

   * (Use `fhir_query` → `snomed_to_icd10` and/or `code_lookup`.)
2. *“For **Jane Doe**, pull **all HbA1c results** (FHIR), confirm the code meaning for the **LOINC** used (Terminology), and summarize the **date/value** pairs.”*
3. *“Grab **ACE inhibitor** medications for **Patient/42** (look up the **RxNorm** ingredient codes first), then list active orders only.”*
4. *“For **Mr. Kim**, list problems where the code is **ICD‑10 I10**, show the **SNOMED translation**, and include each problem’s **onset date**.”*

---

### 2) Retrieval + Lightweight Analytics (Python)

1. *“Pull the last **year of HbA1c** values for **Patient 987** and compute the **percentage < 7%**.”*
2. *“Get **serum creatinine** over the last **90 days** for **Patient 312** and calculate the **max delta within 7 days** after any value above **1.5 mg/dL**.”*
3. *“List the **last 10 BPs** for **Patient 12345** and calculate the **mean arterial pressure (MAP)** for each reading.”*
4. *“Fetch **BMI observations** for **Jane Doe** and return the **trend slope** with a one‑line interpretation (rising, stable, falling).”*

---

### 3) Retrieval + Validation + (Optional) Crosswalks

1. *“Draft a new **Observation** for a BP reading for **Patient/42** (include LOINC and units), **validate** it, then show me the final JSON I could POST.”*
2. *“Create a **Condition** for **Type 2 diabetes** using **SNOMED**, map it to **ICD‑10‑CM** for billing, and **validate** the Condition resource.”*
3. *“Generate a minimal **MedicationRequest** for **lisinopril 10 mg daily** for **Patient 987**, look up the **RxNorm** code to include, then **validate** it.”*

---

### 4) Retrieval + Terminology + Analytics (Phenotyping‑lite)

1. *“Find **possible CKD** in **Patient 12345**: pull creatinine and eGFR observations, confirm code meanings via **LOINC lookup**, then summarize whether they meet **CKD stage 3** thresholds.”*
2. *“Check **heart failure** evidence for **Jane Doe**: look for **SNOMED** problems, typical **ICD‑10** codes (cross‑walk if needed), and supporting **NT‑proBNP** labs with a quick value summary.”*
3. *“For **Mr. Patel**, identify **diabetes with hypertension**: retrieve both problem codes, cross‑check code meanings, and show last **three BP** and **HbA1c** values with simple interpretation.”*

---

### 5) Medication Safety & Monitoring

1. *“If **Patient/42** is on an **ACE inhibitor**, show the last **serum potassium** and **creatinine** within **14 days** of start; compute if either rose by a clinically meaningful amount.”*
2. *“For **Jane Doe** on **metformin**, check **eGFR** values from the past **6 months** and flag if any are **< 30**.”*
3. *“Patient 987 is starting a **statin**. Pull baseline **ALT/AST** and the most recent values within **8 weeks**; tell me if there’s a **≥3× ULN** elevation.”*

---

### 6) Documentation Aids (Cheat‑sheet + Retrieval)

1. *“Before I write a new **MedicationRequest**, give me a **cheat‑sheet** of required fields, then list **existing active meds** so I don’t duplicate.”*
2. *“Remind me of key fields for **Observation** (cheat‑sheet), then show me **all abnormal labs** from the **past 48 hours** for **Patient/42**.”*

---

### 7) Data Quality / Sanity Checks

1. *“Find any **Observations** for **Patient 12345** where the **units** are missing or values look **out of plausible range** (e.g., systolic BP < 60 or > 260). Provide a short list I can fix.”*
2. *“Show **duplicate Conditions** for **Jane Doe** (same code/system, overlapping dates) so I can clean them up.”*
3. *“List **encounters** for **Patient/42** with **no discharge diagnosis** recorded.”*

---

## Extra: Cohort‑ish (if your dataset allows)

1. *“Give me all patients with **E11.9** (map to SNOMED if needed), and for each, pull the **most recent HbA1c**.”*
2. *“List patients with a **hypertension** diagnosis and the **latest three BPs** each; report how many are at **goal (<130/80)**.”*

---

### Tips

* If you’re unsure which code to use, **look it up** (`code_lookup`) before querying.
* Prefer **LOINC** for labs, **SNOMED** for problems, **RxNorm** for meds; cross‑walk to **ICD‑10‑CM** when billing language is requested.
* Keep returned JSON compact when possible (limit to the fields I’d actually read in clinic).


















# Some more stuff that was used in debugging. Might be useful to use for multi-turn training:





---

# 1) Do any EOBs exist at all?
GET [base]/ExplanationOfBenefit?_summary=count

# 2) Try id-only form (some servers prefer this)
GET [base]/ExplanationOfBenefit?patient=1754bc7d-28cd-4933-fc72-3d9a0d77cf54&_count=1

# 3) Chain by the Patient’s identifier (works even if EOB uses a resolvable reference)
GET [base]/ExplanationOfBenefit
  ?patient.identifier=http://hospital.smarthealthit.org|1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &_summary=count

# 4) If EOBs exist but aren’t linked by patient, look by Encounter (if you know an Encounter id)
GET [base]/ExplanationOfBenefit?encounter=Encounter/{some-encounter-id}&_count=5

# 5) If your dataset has Claim/ClaimResponse instead of EOB, use ClaimResponse:
GET [base]/ClaimResponse
  ?patient=Patient/1754bc7d-28cd-4933-fc72-3d9a0d77cf54
  &_include=ClaimResponse:request
  &_sort=-created
  &_count=200

---

# Does your patient have any EOBs at all?
GET [base]/ExplanationOfBenefit?patient=Patient/69672&_summary=count

# Try chained by identifiers (works even if refs are weird)
GET [base]/ExplanationOfBenefit?patient.identifier=http://hl7.org/fhir/sid/passport-USA|X67028255X&_summary=count
GET [base]/ExplanationOfBenefit?patient.identifier=http://hospital.smarthealthit.org|1754bc7d-28cd-4933-fc72-3d9a0d77cf54&_summary=count

# Sanity-check the EOB you found—who is Patient/1127?
GET [base]/Patient/1127


run these

---